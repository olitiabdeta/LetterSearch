<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LetterSearch</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #fafafa;
            padding: 20px;
        }

        h1 {
            text-align: center;
            font-size: 32px;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        select, button, input[type="text"] {
            padding: 8px 12px;
            font-size: 15px;
            font-family: 'Courier New', monospace;
        }

        .game-layout {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* BOARD GRID */
        #boardTable {
            border-collapse: collapse;
        }

        #boardTable td {
            width: 32px;
            height: 32px;
            text-align: center;
            vertical-align: middle;
            border: 1px solid #444;
            font-size: 20px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            background: white;
        }

        /* Word list on the right */
        .word-list-container {
            min-width: 220px;
        }

        .word-list-container h2 {
            margin-top: 0;
            margin-bottom: 10px;
        }

        .word-list-container ul {
            list-style: none;
            padding-left: 0;
        }

        .word-list-container li {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            padding: 3px 0;
        }

        .word-found {
            text-decoration: line-through;
            color: green;
            font-weight: bold;
        }

        .status {
            margin-top: 20px;
            text-align: center;
            font-size: 18px;
            min-height: 20px;
        }

        .status.success {
            color: green;
        }

        .status.error {
            color: red;
        }
    </style>
</head>
<body>
<h1>LetterSearch</h1>

<div class="controls">
    <!-- Theme selector -->
    <label>
        Theme:
        <select id="themeSelect">
            <option value="DESSERTS">Desserts</option>
            <option value="FLOWERS">Flowers</option>
            <option value="STATES">States</option>
            <option value="VOCAB">English Vocab</option>
        </select>
    </label>

    <!-- Difficulty selector (used only for VOCAB) -->
    <label>
        Difficulty:
        <select id="difficultySelect">
            <option value="EASY">Easy</option>
            <option value="MEDIUM">Medium</option>
            <option value="HARD">Hard</option>
        </select>
    </label>

    <button id="startBtn">Start Game</button>
</div>

<div class="game-layout">
    <!-- Puzzle Board -->
    <div>
        <table id="boardTable"></table>
    </div>
    <div id="score" class="status">Score: 0</div>

    <!-- Word List -->
    <div class="word-list-container">
        <h2>Words</h2>
        <ul id="wordList"></ul>

        <div style="margin-top: 20px;">
            <input type="text" id="guessInput" placeholder="Enter a word" />
            <button id="checkBtn">Check</button>
        </div>
    </div>
</div>

<div id="status" class="status"></div>

<script>
    const startBtn = document.getElementById("startBtn");
    const checkBtn = document.getElementById("checkBtn");
    const themeSelect = document.getElementById("themeSelect");
    const difficultySelect = document.getElementById("difficultySelect");
    const boardTable = document.getElementById("boardTable");
    const wordListElem = document.getElementById("wordList");
    const guessInput = document.getElementById("guessInput");
    const statusElem = document.getElementById("status");
    const scoreElem = document.getElementById("score");


    let currentWords = [];

    function setStatus(message, type) {
        statusElem.textContent = message || "";
        statusElem.className = "status";
        if (type) {
            statusElem.classList.add(type);
        }
    }

    // Render the board (char[][]) into the table
    function renderBoard(board) {
        console.log("BOARD FROM BACKEND:", board); // debug

        boardTable.innerHTML = "";
        if (!board || board.length === 0) {
            setStatus("No board data returned from server.", "error");
            return;
        }

        board.forEach(row => {
            const tr = document.createElement("tr");
            const chars = Array.isArray(row) ? row : row.toString().split("");

            chars.forEach(cell => {
                const td = document.createElement("td");
                td.textContent = cell;
                tr.appendChild(td);
            });

            boardTable.appendChild(tr);
        });
    }



    function resetHighlights() {
        Array.from(boardTable.rows).forEach(row => {
            Array.from(row.cells).forEach(cell => {
                cell.style.backgroundColor = "white";
                cell.style.color = "black";
            });
        });
    }

        // Render the list of words
    function renderWords(numWords) {
        wordListElem.innerHTML = "";
        currentWords = [];

        for (let i = 0; i< numWords; i++){
            const li = document.createElement("li");
            li.textContent = "???";
            li.dataset.word = "";
            wordListElem.appendChild(li);
            currentWords.push(li);
        }
    }

    // Mark a word as found in the list
    function markWordFound(word, positions) {
        const target = word.toUpperCase();
        const items = wordListElem.querySelectorAll("li");
        for (let li of items) {
            if (!li.dataset.word) {
                li.textContent = target;
                li.dataset.word = target;
                li.classList.add("word-found");
                break;
            }
        }
        positions.forEach(pos =>
        {
            const[row, col] = pos;
            const cell = boardTable.rows[row].cells[col];
            cell.style.backgroundColor = "lightgreen";
            cell.style.color = "black";
        });
    }

    // Start button: call /start
    startBtn.addEventListener("click", () => {
        const theme = themeSelect.value;
        const difficulty = difficultySelect.value;

        let url = `/start?theme=${encodeURIComponent(theme)}`;
        if (theme === "VOCAB") {
            url += `&difficulty=${encodeURIComponent(difficulty)}`;
        }

        setStatus("Starting game...", null);

        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Failed to start game");
                }
                return response.json();
            })
            .then(data => {
                console.log("GAME DATA FROM /start:", data); // debug
                resetHighlights();
                renderBoard(data.board);
                renderWords(data.numWords);
                setStatus("Game started! Enter a word and click Check.", "success");
            })
            .catch(err => {
                console.error(err);
                setStatus("Error starting game.", "error");
            });
    });

    // Check button: call /check
    checkBtn.addEventListener("click", () => {
        const guess = guessInput.value.trim();
        if (!guess) {
            setStatus("Please type a word first.", "error");
            return;
        }

        fetch(`/check?selected=${encodeURIComponent(guess)}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Failed to check word");
                }
                return response.json();
            })
            .then(data => {
                if (data.correct) {
                    markWordFound(data.selected, data.positions);
                    setStatus(`"${data.selected}" is correct!`, "success");
                    scoreElem.textContent = `Score: ${data.score}`;
                } else {
                    setStatus(`"${data.selected}" is not in the puzzle.`, "error");
                }
            })
            .catch(err => {
                console.error(err);
                setStatus("Error checking word. Did you start a game?", "error");
            });
    });

    // Press Enter in the input triggers Check
    guessInput.addEventListener("keyup", (e) => {
        if (e.key === "Enter") {
            checkBtn.click();
        }
    });
</script>
</body>
</html>
